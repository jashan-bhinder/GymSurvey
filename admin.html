<!DOCTYPE html>
<html>
    <head>
        <meta charset = "utf-8"/>
        <title>Gym Survey - Admin</title>
            <style>
      :root { --gap: 12px; --radius: 8px; }
      * {box-sizing: border-box}
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        margin: 12px auto;
        padding: 0 16px;
        max-width: 720px;
        line-height: 1.5;
        color: #111;
        background: #fafafa;
      }
      h1{
        margin-bottom: 16px
      }
      form {
        display: grid;
        gap: var(--gap);
        margin: 16px 0 8px;
      }
      label {
        font-weight: 600;
      }
      input [type="number"] {
        width: 180px;
        padding: 8px 10px;
        border: 1px solid #d0d0d0;
        border-radius: var(--radius);
        background: #fff;
        font-size:16px;
      }
      input:focus{
        outline: none;
        border-color: #6b9cff;
        box-shadow: 0 0 0 3px rgba(107,156,255,0.25);
      }
      button{
        width: fit-content;
        padding: 8px 14px;
        border-radius: var(--radius);
        border: 1px solid #1f6feb;
        background: #2563eb;
        color: white;
      }
      button:hover{
        background: #1d43d8;
      }
      #status {
        margin-top: 8px;
        color: #374151;
      }
      a {
        color: #2563eb;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
    </style>
    </head>
    <body>
        <h1>Admin: Responses</h1>

        <button id = "clear">Clear all responses</button>
        <button id = "export">Export CSV</button>


        <p id = "summary">Loading...</p>
        <ol id = "list"></ol>

        <p><a href="./index.html">Back to survey</a></p>


        <script>
            const STORAGE_KEY = 'gymsurvey:responses'
            const summary = document.getElementById('summary');
            const list = document.getElementById('list');

            function loadResponses(){
                const raw = localStorage.getItem(STORAGE_KEY);
                try {
                    return raw ? JSON.parse(raw) : [];
                }
                catch{
                    return[];
                }
            }

            function saveResponses(responses){
                localStorage.setItem(STORAGE_KEY, JSON.stringify(responses));
            }

            function toCSV (rows) {
                const header = ['value', 'at'];
                const lines = [header.join(',')];

                for (const r of rows) {
                    const v = String(r.value);
                    const a = String(r.at);
                    lines.push([v, a].join(',')); 
                }
                return lines.join('\n')
            }

            function download(filename, text) {
                const blob = new Blob([text], { type: 'text/csv;charset=utf-8;' }) 
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            
            }
            document.getElementById('export').addEventListener('click', () => {
                if (!responses.length){
                    alert('No responses to export,');
                    return;
                }
                const csv = toCSV(responses);
                download('responses.csv', csv)
            })


            document.getElementById('clear').addEventListener('click', () =>{

                const ok = confirm('Delete ALL saved responses? This cannot be undone. ')
                if (!ok) return;

                saveResponses([]);
                summary.textContent = 'Total Responses: 0'

                while (list.firstChild) list.removeChild(list.firstChild);
            });
            const responses = loadResponses();
            summary.textContent = `Tota; responses: ${responses.length}`;

            for (const item of responses) {
                const li = document.createElement('li');
                const when = new Date(item.at).toLocaleString();
                li.textContent = `ValueL ${item.value} - at ${when}`;
                list.appendChild(li);
            }
        </script>
    </body>
</html>